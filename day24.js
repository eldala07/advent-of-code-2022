const exampleInput = [
	["#", "E", "#", "#", "#", "#", "#", "#"],
	["#", ">", ">", ".", "<", "^", "<", "#"],
	["#", ".", "<", ".", ".", "<", "<", "#"],
	["#", ">", "v", ".", ">", "<", ">", "#"],
	["#", "<", "^", "v", "^", "^", ">", "#"],
	["#", "#", "#", "#", "#", "#", ".", "#"],
];

const realInput = [
	["#",".","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#"],
	["#",">","v","<","^","^",">","<","<",">","^",">","^",">","v","<",">",">","^","^",".","v",">","^","v","v","<","^","v","<","v",">","<","v","v",".","^","^","^","^","v","<","v","<","v",">","<","<","^","v",".","<",">","^","^","^",">",">",">",">",">","<","^","<",".","v","v","v","v","v",".","^","v",">","v","v","<",">","v","<","v","<","^",">","^","v","<","^","v",".","<",">",">","v","<",">","<","v","^","v",">",".","v",">","^","v","v","^",">",">","<","v",">","v",">",".","^",">",">","<",">","#"],
	["#","<",".","v","<","v",">",">",">",".",">",">",">",">","^","<","v","v",">","<","^","^","v",">",">","v",">","^",">","<","v","^",">","^","<",".","<","v","^","<",">",">",">","<","v","<","v","v","<","<","^","^","<","^","^","v","^","<",".",">","v",".","v",">",">",".","v","<","^",">","<","v","<","v","<",">","^",">","<","^",">","^",">",">","<",".","<","<","<","<","^",">","^","^","^","v",".","v",".",">","v",">","<","^","<","^","v","^",">",".",">","^",">",">","v","v",".","v","^","<","<","#"],
	["#","<","<",">","v",">","^","<","<","^","v","^","<","<","<","v","v",".",">","^","^",">","^","^","v","^",">",">","v","<",">","v",">","v","<",">","<","^","^","v","<","^",">",">","<","^","<",">","^","^","v","^","v","v","<","v","<","<","<",">","^","v","^","v","<",".","<","^",">","^","<",">",">",">",".","<",">","<","<","<","v","<","v","<","<","<","v","v","<",">",">","v",".","^","^","<","v",".","v","v","<","^","<","^",">","<","^","<","v","v","^","v","<","v","<","v",">","v",".","^","<","#"],
	["#",".","v","^","v","<","v","<",">",">",">",".","v","^","v","v","<","<","v","^","<","v","v","<","<","v","v","v","^",">","^","^","v",".","v","^","v","^","^","v","<",">","^","^","^","^","^",">","<",".","v","^","v",">",">","v",">",">","^",">","v","v","v","^","^","<","<","^",">","^","v","^",".","v","<","^","<","<","^","v","^","v",">",">","v","v",".","<","<","^","<","<","v","<","v",">",">","^","v",">","^",">","v",".","v","^",">","<",">","<","v","v","v","^",">","v","<",">","^","<","<","#"],
	["#","<","v","<","^","<","v","<","^","<",">","v",">",">","v","^",">",">","^","<","<",">",">","v",".","^","^","<",">","v","v","^","<",">","<",".","v","^",">",">","<","<","^","<","v",">","<","<","^",">",">","^","^","^","<","v","v",">","^","<","v",">",".",">",">","<","<",".","v","^","v","^","<","v",">","^","<","v",">",">",">",">","v","v","v","<",">","<","^",">","<","<","<","v",">","v",">","v",".","^","<","<",".","<","v","^","<",">","v","v","<","v","<","<",">","v",">","^",">","v",">","#"],
	["#",".","^",".","<",">","v",">","v","^","v","<","v",">",">","v","<",">","v",">","v","v","<",".","^",">","<","^","v","<","<",">","<",">","^",".","^",">",">","v","<","^","v",".","v","^","^","^","^","<","v","v",">","^","<","v","v","^",">","v","v","^",">","^",".","<",">",".","<","^","^","v","<",">",">","<","^","^","^",".",">","<","^","v",">","v","^","^","<",">","v",">",">","v",">","<",">",">","v",".","^","^","<",">",">","v","<","<","^","<","^","<","v","<","v","v",".",">","^","<","<","#"],
	["#",">","^","v","^",">","^","v",">",".",".",".","^","<",">","^",".","<","v",">",".","v","<","v","<",">","^","^","v","<","<","<","^",".","v",">","v",">","^",".",">","<","<",".","v","<","v","<",">",".",">","v",">",">","v",">",">",">","<","<","v","<",">","<","^",".","v",">",".",">",">",">","^",">","^",">",".","v","<",">",">",">","v","<","^","^",">","^","v","<","<","^","v",">","^","v","^","<","v",".","v",">",">","<",">",">","<","v","v","v","^","v",">","v","^","v","<","v","<","<","<","#"],
	["#","<","^",".","v","v",">","<","<",">","<",">","v","^","^","<","^",".","<","^","<",">","<",".",".","v",".","^","v","v","<","v",".","v","v","v",">","<","v","<","^","v",">","v","<","^","v",">","v","^","v","^","^","^","^","<",">","^","^","^",".","^","^","^","v","^","v",">",">","v","^",">",">","<",">","v",">","^","<",">","v","^","^",".","^","<","^","^","<","v",">",">","v","^","v","v","v","v",">",">","v","^",">","<","^","<","<",">",">",">","^","<","<","^","v","^","^","<","<",">","<","#"],
	["#","<",">",">","<","^","<","^","<","<","^","v","^",">",">",">","v","<",".",">",".",".","v",">",".","^",">",">","^","v","^","<","<","v","^","<","<","v","v","<","^","v","^",">","<","<",".",">","<","^","^",">","<",".","v","v","v","^",">",">",".",">",">","^","<","^","v","v",">","<",".","v",">","^","^",">",">",">",".",">","^","v","v","<","^","<","<",">","v","v","<",">","v","v","^","^","^","v",".",">",">",">",">","<",".",".","v",">",".","^","<","^","v","<",">","v",".","<","v","v","<","#"],
	["#","<","<",".","<",">","<",">",".","<","^","<","<","<","<","^",">","^","<",">","^","v","v","^",">","^",">","^",">","v","v",">",">","v",">",">","v","^",">",".","^",".",">","v","v","<",">","<",".","v",">","<","<",">",">","v","v","v",".","v","^","^","v","v",">",">",">","v","<","v","<",">","<","^","<","^","<",">","^",".","v","<","^","^",">","^",">","<",".",">",">","^","^","^","^","^","v","v","<","<","^",">","^","<","<","v","<","^","v","^","<",".","v","<","<","v","<","<",".","<","<","#"],
	["#",">",">","v",">",".","^",".","<",">","<",">","^",".","v","v","v","<","v","v",">","^",">",".","^","^",".","v",">","^","v",".","v",">","^","<","v","v","^","v",">","v",">","^","v","^","v","v","<","<",">",">","<","v",".","<",">","<","<","v",">","<",">","^","<","^","<","v","<",">",".","<","^","<","^","^","<",">","^","<",">",">","v","^","v",".","^","<","v","^","^","<","v","^",">","v","<","<","^",".","^",">",">","^","v",">","^","^","^",">","v","v",".","v",".",">","^","v",">","^",">","#"],
	["#",">","^","<",">","v","^","^","^","v","<","v","^","v","v",">",">","v",".","^",">",">",">","^","v",">",">","<",">","^","v","^",">","<","v","^",".","v",">","<","<",">",">",">","<","^","<","<",".","<",">","v","<",">","<",">","<","^","v","^",">","^","^","<","^","^",">",">","^","v","^",">","^",">","^","v","v","^","<",">",">",">","^","v","^","<",".","v","^","^","^","v","<","v","<","v",".",".",".",">","^",">","^","<","^","^","v","<","v","^","^","v",">","^","^",">",".","<","^","^",">","#"],
	["#","<","v","<","v","^","^","v","<",">",">","<","<","<","^","v","v","v","<","v","v",">",">",".","^",".","<",">",">",".","^","v","^","^","<",">",">","v","^","^",">","v",">","<",">","v",">","<","v","<","^","^",".","v","^",">",">",".","v","v","^","v",">","<",">","^","^","v","<",">",">","^",">","^","<","<","^",".",">","v","<","v","^","v","v","v","^",".",">","<","<","<","v",".","^","^","<","v","v","v","^","<",".",">",">","^",".","<","<","v","v","^","<","<","<",">",".","^",">",">","<","#"],
	["#",">",".",">","^",".","v",".",">",">","^","<","v",">","<",">","<","^","<",".",">","^","v","<",">","<",">","v","^","^","<",".",">","v","v","v","<",">","<",">",".","<","v","<",">",".",">","<","<",".","^","v","^","^","v","^",".",">","v","v","v","v","^",">",".","<",">",">","<","<","^","v","<","<",">","^","<","<","<",">","<","<",">",">","^","<","^",">","^","v","<","^","v","<",">","v","^",">","v","<","v","<",".",">","^","<","^","v","v","<",">","^","<","^",">",">","^",">","^","<","<","#"],
	["#","<",".","^",".",">","^","v","v","<",">","<",">","^","^","<","^","<",".","<",">","v","v",".",">","^","<","<","<",">","v",">","<",".","<","<","v","<",">","^","<",">",">","v","<","^","^","<","v","^","v","^","^",">","v","<","v","<","^","<","v","v","<",".","v","^","<",">","v","<","^",">",">",".","<",">","^","<","^",".","v","v",">","<",".",">","<","v","<","^","<","<","^","<","<",">","^","<",">","v","<","v","v","v","^","v","^","^",">",">","<","v",">","v",">",".",".","v","<","<",">","#"],
	["#","<","^","v",">",">","<","<","v",".","^","^",".","<","^",">","^","<","^","v","v","v",".","^","v","^","v","<",">","v","v","^","v","<","^","v","v","v","v","v","v","^","v",">","<",">",">",".","^","<","<","^","v",">","v",".","v",".",">",".","^","<","<","^","^",">",">",">","v","^",">","<","v","^",">",">",">",".","v","^","^",">",".",">",">","<","^",".","^","^",".",">",".",">","v","^","<","v","^",">","^","<","<","v","<","<","^",">","<",">","v","<","^","^",">","^","<","v","<","v","<","#"],
	["#",".","v",">","<","v",">",">",">","v","^",">","^","^","v","<",">","^","<","<",">",">","^","<","v",">","^",">","<","<","v","^",">","<","^",".","<","<","v","<","v","v","<","<","^","v","^","^",">","<",">",">","<","^","^",">","<",">","<","^","^","^","v","v",">",".","^",">",".","<","v",".","^","v","<","v","<","^","<","<",".","v",".",">",">",">",">","<","<","<","^","v","<","<",".","<","^","<",">","v",".","^","<","^","<","v","v","v","<",".","v","<",".","v",">","<","^",">","v","<",">","#"],
	["#","<","v","<","v","^","<","^","v",">","<","<","^","<",">","^",">",">",">",">","^","^","v","<",">","^","^",">","v","<","v",".","^","^","^","^","^",".","^","<","^","<","<","^",">","<","<","v","^",">","<","^",".",">","<","^",">","<","v","^",">",".","^",">","v","^","v",">","v",".",">","<","^","<","^",">","v","<",">","^",">",".","<",">","^",".",".","<","<",">","^","^",">","^","<",">","<","^","<","^",".",".","v","v",">","v","^","^","^","v",">","^","^","<",".",".","^",".","v","<",">","#"],
	["#",">","v","<","<","v","<","<","<","^",".","^","v","v","v",">",">","v",".",">","v","^","v",">","v","<",">","<","v",".","^",">","<","^","v","<",">","^","v","<","v","^","v","<","v","<",".","^","^",".",">","v",">",".","v",">","v","v","v","v","^",">","v","v","^",">","^","^","v",">","<","v","^",">",">",">",".","<","v","^",">",">","<",".","<","v",">","<","<",".",">",">","^","^","v","^","v","v","v","<","v","v","^","^","^","<","^",">","v","^",">","v","v",">","^",">","^","v","v",">",">","#"],
	["#",">","<","<","v",">","^",">",">",">",">","v","v","<","<",">","<",">","^",">","^","v",">","^","v","v","^","<","^","v",">","<",">","v","^",".","<",".","^",".","v",">","^","<","<","^","v",">","v","<",".","^","v",".",">","^","v","<","^","^","^",">","v","^","^",".","^",">","v","v",".","<","v","^",">",">","^",".",">","<","<",">",">","^","<","<",">",".",">","v",".","v",">",">","^",".",".",">",">","<","<",".",".","v","^",">",">","<",">","v","<",">",".","<","^","v",".",">",">","^","<","#"],
	["#",".","<","<","^","^","<",".","^","v",">",">",">",">",".",">","^","v","v","<","^","<","<",">",">",">",">","^","v",">","v","<","^",".","v","^","<","^",">",">","v","^","<","^",">","^","^",">",">","v","<",">","^","<","v","^","^","^","^",">",">","<","^","<","^","^",">",">","v","<",".","<","<","v",".","^","v","<",">",">",".","v","v","^","^","^","<","v","^","^",".","^","v",".","<",">","^",">","^",">",">","<",">","<","^",".","v","v","<","v",">","v",">","v","<","^","^",">",".","<",">","#"],
	["#","<","<","<","v",">",".","^","v",">","v",">","v","<","^","^",">","v","v","^","<","v","v","<","v","v",">","<","v",">","v","<","v","v","<",".",">","v","v","<","^","^","^","<",".","v","<",">",".",".","^","<","<","<","<","<","^","^","^",">",">","<","v","^","^",">",">","^","<","<","^","v","^",">",">","<",".","^","<","^",".","<","^",".","<","v","<","v","v","<",".",".","^",".",">","<","<",">","v","v","<","^","<","v","<","v",".","<",">",".","<","<","^","v","<","<","^",">","v","v","<","#"],
	["#",".",">","^","^",".","<","<",">",".",">",">",">",".","<","^","<",">",".","<","<","v","<","^",">","v",">","v",">","v","^","v","^","<","v",">","v","^","<","^",">","^","<","<",">","v","^","^","v","^","v","^","^","^","<",">","^","v","v","v","^","v","v","<",".","^","^",">",".","v","^","<",".",">",">","^",">","v","v","v","^",">",".","v","^",">","v","^","v","^",">",".","^","^","<","v","<","<","v","v","^","^",">","v",">","^","v","v","v","v","v","<","v","v","v","^","<","<",">",">",">","#"],
	["#","<","^","v","^",".","<","<","<",">","<","^","<","<","v","^","^","^","v","^","^","^","<","^","^","<","<",">",".","^","<","^","v","<",".",">",".","^","^",".",".","^","v","<","<","^",">","^",".","<","<",">",">",".","<","^",">","v",".","^","<","v",">",".","v","^","^",".","<","v","v","^","^",">","v","^",">","<","v","^",">","<","^",".",">",">",">",">",">","^","v","<","v","<","^","v","v","^","^",">","^","v","^",".","^",".","^","^","^",">","v","^","<",".",">","<",">","^","^",">",">","#"],
	["#",".","v","^","v","v",".","^","v",">","v","v",">",">","v","<","v","v","^","^","v","<","v",">",">","<",".","<",">",">","<","^","^",">","^","v",".","v","v","v","v",">",">","<","^","^",">","v","^","v",">",".","v","^","<",".","<","^",".","<","^","<","^","v",".",">","<","v",">","^","v","<","<","^","^","<",">","v","v",">",">",">","^","v","^","v","^","<","^","<","^","^","^",">",".",".","<",">","<","^","<","^",".","v","v","<","<","<","v",">","v","^",".","^",">","^","<",">","^",">","<","#"],
	["#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#","#",".","#"],
];

// STRATEGY
// 1. Simulate movement of blizzards 2 cases away from the E (expedition)
// 2. If all adjacent cases are blizzards, the E can't move this turn and wait for the next turn
// 3. If there are some cases that are not blizzards, the E can move to the closest case that is not a blizzard (with bfs) and add 1 to his steps
// 4. Repeat until the E is on the exit node which is on the edge of the map

const getEPos = input => {
	for (let y = 0; y < input.length; y++) {
		for (let x = 0; x < input[y].length; x++) {
			if (input[y][x] === "E") {
				return { x, y };
			}
		}
	}
};
const getExitPos = input => {
	let x = 0;
	for (let y = 0; y < input.length; y++) {
		if (input[y][x] === ".") {
			return { x, y };
		}
	}
	x = input[0].length - 1;
	for (let y = 0; y < input.length; y++) {
		if (input[y][x] === ".") {
			return { x, y };
		}
	}
	let y = 0;
	for (let x = 0; x < input[y].length; x++) {
		if (input[y][x] === ".") {
			return { x, y };
		}
	}
	y = input.length - 1;
	for (let x = 0; x < input[y].length; x++) {
		if (input[y][x] === ".") {
			return { x, y };
		}
	}
};

const moveBlizzards = (input, blizzards) => {
	blizzards.forEach(blizzard => {
		if (blizzard) {
			switch (blizzard.direction) {
				case "^":
					if (blizzard.y - 1 === 0) {
						blizzard.y = input.length - 1;
					} else {
						blizzard.y--;
					}
					break;
				case "v":
					if (blizzard.y + 1 === input.length - 1) {
						blizzard.y = 0;
					} else {
						blizzard.y++;
					}
					break;
				case "<":
					if (blizzard.x - 1 === 0) {
						blizzard.x = input[0].length - 1;
					} else {
						blizzard.x--;
					}
					break;
				case ">":
					if (blizzard.x + 1 === input[0].length - 1) {
						blizzard.x = 0;
					} else {
						blizzard.x++;
					}
					break;
			}
		}
	});
};

const simulateCloseBlizzardsMoves = (ePos, blizzards, input) => {
	const possibleMoves = [{ x: 0, y: 0 }];
	const blizzardsCloseToE = [
		...blizzards.filter(b => Math.abs(b.x - ePos.x) <= 2 && Math.abs(b.y - ePos.y) <= 2),
	];

	moveBlizzards(input, blizzardsCloseToE);

	const blizzardsCloseToEOnLeft = blizzardsCloseToE.filter(b => b.x < ePos.x);
	const blizzardsCloseToEOnRight = blizzardsCloseToE.filter(b => b.x > ePos.x);
	const blizzardsCloseToEOnTop = blizzardsCloseToE.filter(b => b.y < ePos.y);
	const blizzardsCloseToEOnBottom = blizzardsCloseToE.filter(b => b.y > ePos.y);

	if (blizzardsCloseToEOnLeft.length === 0 && input[ePos.y][ePos.x - 1] !== "#") {
		possibleMoves.push({ x: -1, y: 0 });
	}
	if (blizzardsCloseToEOnRight.length === 0 && input[ePos.y][ePos.x + 1] !== "#") {
		possibleMoves.push({ x: 1, y: 0 });
	}
	if (
		blizzardsCloseToEOnTop.length === 0 &&
		!!input[ePos.y - 1] &&
		input[ePos.y - 1][ePos.x] !== "#"
	) {
		possibleMoves.push({ x: 0, y: -1 });
	}
	if (
		blizzardsCloseToEOnBottom.length === 0 &&
		!!input[ePos.y + 1] &&
		input[ePos.y + 1][ePos.x] !== "#"
	) {
		possibleMoves.push({ x: 0, y: 1 });
	}
	// console.log("File: day24.js, Line 114 possibleMoves: ", possibleMoves);
	return possibleMoves;
};

const moveE = (currentPos, increment) => {
	return { x: currentPos.x + increment.x, y: currentPos.y + increment.y };
};

const bfs = (start, end, blizzards, input, allResults, maxSteps) => {
	const queue = [[start, 0]];

	while (queue.length > 0) {
		// console.log('File: day24.js, Line 134 allResults: ', allResults);
		const current = queue.shift();
		// console.log('File: day24.js, Line 135 current[1] + 1: ', current[1] + 1);
		const ePos = current[0];
		// console.log("File: day24.js, Line 132 ePos: ", ePos);

		const possibleMovesForE = simulateCloseBlizzardsMoves(ePos, blizzards, input);
		if ((ePos.x === end.x && ePos.y === end.y) || current[1] + 1 === maxSteps) {
			allResults.push(current[1] + 1);
			return current[1] + 1;
		}

		possibleMovesForE.forEach(move => {
			const newEPos = moveE(ePos, move);
			queue.push([newEPos, current[1] + 1]);
		});
	}
};

const partOne = (input, maxSteps) => {
	const ePos = getEPos(input);
	const exitPos = getExitPos(input);
	const blizzards = input.reduce((acc, row, y) => {
		row.forEach((char, x) => {
			if (char === "v" || char === "^" || char === "<" || char === ">") {
				acc.push({ x, y, direction: char });
			}
		});
		return acc;
	}, []);
	const allResults = [];
	bfs(ePos, exitPos, blizzards, input, allResults, maxSteps);
	// console.log("File: day24.js, Line 143 allResults: ", allResults);
	return Math.min(...allResults);
};

console.log(partOne(exampleInput, 1000));
console.log(partOne(realInput, 1000));
